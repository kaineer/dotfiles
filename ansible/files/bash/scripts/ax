#!/usr/bin/env bash

## bootstrap
BIN=$(readlink -f $0)
DIR=$(dirname $BIN)
DF_DIR=$DIR/../../../..
EDITOR=${EDITOR:-vi}
[ -x $HOME/bin/nvim ] && EDITOR=nvim

DF_PASS_DIR=$HOME/.password-store
DF_PASS_REPO=git@gitlab.com:kaineer/pass-store.git
## bootstrap

debug() {
  [[ "$DEBUG" == "true" ]] && echo " [DEBUG] " $@
}

edit_ansible_config() {
  $EDITOR $DIR/../../../ansible.cfg
}

edit_script() {
  $EDITOR $DIR/$1
}

edit_script_list() {
  $EDITOR $DF_DIR/ansible/vars/scripts.yml
}

apply_dotfiles() {
  cd $DF_DIR
  ./bin/dotfiles.sh
}

edit_debian_vars() {
  cd $DF_DIR
  $EDITOR ./ansible/vars/
}

nothing_to_commit() {
  git status . | grep "nothing to commit" | wc -l
}

pass_ops_clone() {
  if [ ! -d $DF_PASS_DIR ]; then
    git clone $DF_PASS_REPO $DF_PASS_DIR
  fi
}

pass_ops() {
  case "$1" in
    "clone") pass_ops_clone ;;
  esac
}

ssh_key_copy() {
  cat $HOME/.ssh/id_rsa.pub | xsel -b
  notify-send "Ax" "SSH key is copied"
}

key_ops() {
  case "$1" in
    "gh"|"github")
      ssh_key_copy
      open "https://github.com/settings/keys"
      ;;
    "gl"|"gitlab")
      ssh_key_copy
      open "https://gitlab.com/-/user_settings/ssh_keys"
      ;;
  esac
}

case "$1" in
  "ce")        edit_ansible_config ;;
  "v"|"vars")  edit_debian_vars ;;
  "se")        shift; edit_script $1 ;;
  "sel")       edit_script_list ;;
  "pass")      shift; pass_ops $@ ;;
  "")          apply_dotfiles ;;
  *)
    F=$DIR/ax.d/$1
    shift
    [[ -f $F ]] && source $F $@
    ;;
esac
